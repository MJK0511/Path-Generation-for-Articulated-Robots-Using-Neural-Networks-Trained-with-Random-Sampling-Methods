import os
import rospy
import actionlib
from control_msgs.msg import FollowJointTrajectoryAction, FollowJointTrajectoryGoal
from trajectory_msgs.msg import JointTrajectory, JointTrajectoryPoint

class MoveOnePoint:
    def __init__(self):
        rospy.init_node('xArm6')

        self.joint_names = ['joint1', 'joint2', 'joint3', 'joint4', 'joint5', 'joint6']

        self.client = actionlib.SimpleActionClient('/xarm/xarm6_traj_controller/follow_joint_trajectory', FollowJointTrajectoryAction)
        self.client.wait_for_server()

    def movetopoint(self, goal_positions):

        # goal point
        
        trajectory = JointTrajectory()
        trajectory.joint_names = self.joint_names

        # 웨이포인트 추가
        num_waypoints = 3  # 원하는 웨이포인트 수로 변경
        duration_per_waypoint = 1.0  # 각 웨이포인트에 도달하는 데 걸리는 시간(초)

        for i in range(num_waypoints):
            point = JointTrajectoryPoint()
            point.positions = goal_positions
            point.time_from_start = rospy.Duration(i * duration_per_waypoint)
            trajectory.points.append(point)

        # ゴールの設定
        goal = FollowJointTrajectoryGoal()
        goal.trajectory = trajectory

        # アクションを実行
        self.client.send_goal(goal)
        self.client.wait_for_result()

        result = self.client.get_result()
        if result.error_code == result.SUCCESSFUL:
            print("successful!")
        else:
            print(f"failed! Error message: {result.error_string}")

# goal_positions = [-0.0757597751047898, -0.0855379354935719, -0.3967935455350373, 0.0007703124332953, 0.4147338313256012, 0.3060854672165192] # 1
# goal_positions = [-0.8304666616954881, -0.34674362198990116, -0.8666510320485331, -0.007538178730394612, 0.7330232825309875, -0.16776772967368336] # 8
# goal_positions = [-0.3162292465578266, -0.17438651643311082, -0.7225610351691045, -0.009521291667954415, 0.6605275900315886, 0.020242439590844527]
# goal_positions = [-1.5187752830490653, -0.2532509988244342, -0.9982779568703236, -0.006446752008122426, 0.8738977970057165, -0.09928282972498026]
# goal_positions = [-0.0659941235574066, -0.09712417005167295, -0.5903307941740497, -0.021523133047856247, 0.5604806275100962, 0.132160498286048]
# goal_positions = [-0.66068417610226, -0.0010136193348466715, -1.0400148198750452, 0.04501822726016927, 0.72995053504994, -0.15585378669302288]
# goal_positions = [-1.2352692947117505, 0.0025471149276867777, -1.2755746821663858, -0.036460171393903236, 0.803869263229013, -0.1527127238093116]
# goal_positions = [-1.5812841303709408, -0.20749840083142257, -0.6677367768883964, 0.0005003370368789929, 0.8121456157684503, -0.11990713088704436]
# goal_positions = [0.03282510385336083, -0.043487474039307084, -0.5281358238205831, 0.012433875232392463, 0.6054164243287457, 0.23713606607815307]
# goal_positions = [-0.26095783569391473, -0.06926498514891821, -0.7353093550549559, 0.016267455629875097, 0.7099980294164674, -0.03906705789874376]
# goal_positions = [-0.5442591695636001, -0.0011782341935509533, -0.9590830129529015, 0.04095702941079969, 0.7251723053513912, -0.12490973300495553]
# goal_positions = [-0.8004961446269343, -0.006747435335088259, -1.105357900920653, 0.042488276878295844, 0.7522702228051826, -0.20581786322495055]
# goal_positions = [-1.141026272702299, 0.006529714786445762, -1.2845601231876722, 0.05190828034589688, 0.7799624091966556, -0.17792455425623865]
# goal_positions = [-1.3663717562332645, 0.05155311707084548, -1.3029575383648377, -0.060875240897965956, 0.8287354072981427, -0.11596565495077737]
# goal_positions = [-1.5451471817585398, -0.18556430682353287, -0.8241092675903346, -0.009163503115018007, 0.8241413177020774, -0.04761425033901423]
# goal_positions = [-1.6082595409562908, -0.15919996167219153, -0.5183557849990639, -0.0011414232067991394, 0.8045258283206835, -0.19561433101942255]
# goal_positions = [-1.608233401684757, -0.1451752843209001, -0.4024585381125415, -0.0018923599162992, 0.5639977333135698, -0.2142347776359253]


# goal_positions = [0.25198430342875733, -0.18799615260303146, -0.5466557929679237, 0.015877223088157644, 0.540076835688842, -0.23142792351935057]
# goal_positions = [0.06822503890571302,-0.23615880804134165,-0.5961415891338372,0.030465349252032592,0.5399877075094481,-0.21958956537046728]
# goal_positions = [-0.11553422561733118,-0.2843214634796518,-0.6456273852997506,0.04505347541590754,0.5398985793300544,-0.20775120722158402]
goal_positions = [-0.29929349014037554,-0.33248411891796203,-0.6951131814656641,0.05964160157978249,0.5398094511506605,-0.19591284907270076]
# goal_positions = [-0.4830527546634198,-0.3806467743562722,-0.7445989776315776,0.07422972774365744,0.5397203229712666,-0.1840744909238175]
# goal_positions = [-0.6668120191864639,-0.42880942979458236,-0.794084773797491,0.08881785390753238,0.5396311947918727,-0.17223613277493421]
# goal_positions = [-0.8505712837095083,-0.47697208523289253,-0.8435705699634044,0.10340598007140733,0.5395420666124788,-0.16039777462605095]
goal_positions = [-1.0343305482325527,-0.5251347406712028,-0.893056366129318,0.11799410623528228,0.5394529384330851,-0.1485594164771677]
# goal_positions = [-1.4018490772786412,-0.6214600515478231,-0.9920279584611449,0.14717035856303218,0.5392746820742973,-0.12488270017940115]
# goal_positions = [-1.4455684284068315,-0.5584151603360271,-0.9135984377067461,0.1256332990092081,0.6049893776090094,-0.11642906313969542]
# goal_positions = [-1.4892877795350217,-0.4953702691242312,-0.8351689169523474,0.10409623945538407,0.6707040731437216,-0.1079754260999897]
goal_positions = [-1.533007130663212,-0.4323253779124352,-0.7567393961979487,0.08255917990156,0.7364187686784338,-0.09952178906028397]
# goal_positions = [-1.5767264817914024,-0.36928048670063923,-0.6783098754435499,0.06102212034773595,0.8021334642131459,-0.09106815202057825]
# goal_positions = [-1.6204458329195928,-0.3062355954888432,-0.5998803546891511,0.03948506079391188,0.8678481597478581,-0.08261451498087251]
# goal_positions = [-1.664165184047783,-0.2431907042770473,-0.5214508339347524,0.01794800124008783,0.9335628552825702,-0.0741608779411668]



moving = MoveOnePoint()
moving.movetopoint(goal_positions)